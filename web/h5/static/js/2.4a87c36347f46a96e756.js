webpackJsonp([2],{W4Yd:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r("eqfM");var a=r("/QYm"),i=r("Xxa5"),n=r.n(i),s=r("exGp"),u=r.n(s),o=r("Dd8w"),c=r.n(o),d=(r("PirY"),r("gyMJ")),l=r("NYxO"),f=r("Du/2"),v={data:function(){return{playUrl:"",requestCount:0}},computed:c()({},Object(l.mapState)("course",{joinStatus:function(e){return e.joinStatus}}),Object(l.mapState)({isLoading:function(e){return e.isLoading}})),mounted:function(){var e=this;return u()(n.a.mark(function t(){return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.handleLive();case 1:case"end":return t.stop()}},t,e)}))()},methods:c()({},Object(l.mapMutations)({setNavbarTitle:f.f}),{handleLive:function(){var e=this.$route.query,t=e.taskId,r=e.replay,a=e.title;this.setNavbarTitle(a),r?this.getReplayUrl(t):this.requestLiveNo(t)},getReplayUrl:function(e){var t=this;d.a.getLiveReplayUrl({query:{taskId:e}}).then(function(e){e.nonsupport?Object(a.a)("回放暂不支持"):e.url?e.url.indexOf("/error/")>-1?Object(a.a)("暂无回放"):t.playUrl=e.url:e.error&&a.a.fail(e.error.message)}).catch(function(e){a.a.fail(e.message)})},requestLiveNo:function(e){var t=this;d.a.requestLiveNo({query:{taskId:e}}).then(function(r){r.no&&t.getLiveUrl(e,r.no),r.error&&a.a.fail(r.error.message)}).catch(function(e){a.a.fail(e.message)})},getLiveUrl:function(e,t){var r=this;this.requestCount++,d.a.getLiveUrl({query:{taskId:e,no:t}}).then(function(i){i.roomUrl?r.playUrl=i.roomUrl:r.requestCount<30?r.getLiveUrl(e,t):Object(a.a)("获取直播失败"),i.error&&a.a.fail(i.error.message)}).catch(function(e){a.a.fail(e.message)})}})},h={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"web-view"},[this.isLoading?t("e-loading"):this._e(),this._v(" "),t("iframe",{attrs:{id:"player",src:this.playUrl,width:"100%",height:"100%",frameborder:"0"}})],1)},staticRenderFns:[]},m=r("VU/8")(v,h,!1,null,null,null);t.default=m.exports},pEIs:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("Xxa5"),i=r.n(a),n=r("//Fk"),s=r.n(n),u=(r("eqfM"),r("/QYm")),o=r("exGp"),c=r.n(o),d=r("Dd8w"),l=r.n(d),f=r("PirY"),v=r.n(f),h=r("gyMJ"),m=r("NYxO"),p=r("Du/2"),y={data:function(){return{media:""}},computed:l()({},Object(m.mapState)("course",{details:function(e){return e.details},joinStatus:function(e){return e.joinStatus}}),Object(m.mapState)({isLoading:function(e){return e.isLoading}})),mounted:function(){var e=this;return c()(i.a.mark(function t(){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.a.getMedia(e.getParams()).catch(function(e){return Object(u.a)(e.message),s.a.reject(e)});case 2:r=t.sent,["ppt","doc"].includes(e.media)?e.initPlayer(r):(e.$refs.text.innerHTML=r.media.content,e.setNavbarTitle(r.media.title));case 4:case"end":return t.stop()}},t,e)}))()},methods:l()({},Object(m.mapMutations)({setNavbarTitle:p.f}),{getParams:function(){var e=this.$route.query,t=e.courseId,r=e.taskId,a=e.type,i=!this.joinStatus&&Number(this.details.tryLookable||!0);return this.media=a,i?{query:{courseId:t,taskId:r},params:{preview:1}}:{query:{courseId:t,taskId:r}}},initPlayer:function(e){var t=e.media,r="//service-cdn.qiqiuyun.net/js-sdk/sdk-v1.js?v="+Date.now()/1e3/60;v()(r,function(r){if(r)throw r;new window.QiQiuYun.Player({id:"player",resNo:t.resId,token:t.token,source:{type:e.mediaType,args:t}})})}})},g={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"web-view"},[this.isLoading?t("e-loading"):this._e(),this._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:"text"!==this.media,expression:"media !== 'text'"}],attrs:{id:"player"}}),this._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:"text"===this.media,expression:"media === 'text'"}],ref:"text",staticClass:"media-text"})],1)},staticRenderFns:[]},w=r("VU/8")(y,g,!1,null,null,null);t.default=w.exports}});