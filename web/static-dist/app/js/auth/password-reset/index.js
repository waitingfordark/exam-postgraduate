webpackJsonp(["app/js/auth/password-reset/index"],{0:function(e,t){e.exports=jQuery},"8fe9b6e117bbb964d58b":function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),o=a("0282bb17fb83bfbfed9b"),i=(r(o),a("bbc0ef257199acca9fed")),c=r(i),d=a("5eb223de522186da1dd9"),u=r(d),l=a("b334fd7e4c5a19234db2"),f=r(l),h=a("971935e6d9dafc951b13");a("9415ea13985847610e60"),new(function(){function e(){n(this,e),this.event(),this.dragHtml=$(".js-drag-box").html(),$(".js-drag-box").remove(),$("#password-reset-form").prepend(this.dragHtml),this.drag=new c.default($("#drag-btn"),$(".js-jigsaw"),{limitType:"reset_password"}),this.smsEvent(),this.validator(),this.smsToken=""}return s(e,[{key:"event",value:function(){var e=this;$(".js-find-password li").click(function(){var t=$(this);if(!t.hasClass("active")){t.addClass("active").siblings().removeClass("active");var a=$(t.data("target"));a.length>0&&($("form").hide(),e.drag.unbindEvent(),$(".js-drag").remove(),a.prepend(e.dragHtml),e.drag=new c.default($("#drag-btn"),$(".js-jigsaw"),{limitType:"reset_password"}),a.show())}})}},{key:"smsEvent",value:function(){var e=this,t=$(".js-sms-send"),a=this;t.click(function(){if(e.mobileValidator.element($('[name="dragCaptchaToken"]'))){if(t.hasClass("disabled"))return;t.addClass("disabled"),u.default.resetPasswordSms.get({params:{mobile:$("#mobile").val()},data:{dragCaptchaToken:$('[name="dragCaptchaToken"]').val()}}).then(function(e){(0,f.default)("success","短信发送成功"),t.removeClass("disabled"),(0,h.countDown)($(".js-sms-send"),$("#js-fetch-btn-text"),120),a.smsToken=e.smsToken}).catch(function(){t.removeClass("disabled"),a.drag.initDragCaptcha()})}})}},{key:"validator",value:function(){var e=this;$("#password-reset-form").validate({rules:{email:{required:!0,email:!0},dragCaptchaToken:{required:!0}},messages:{dragCaptchaToken:{required:Translator.trans("site.captcha_code.required")}},submitHandler:function(t){var a=$("#password-reset-form").find('[name="email"]').val();u.default.resetPasswordEmail.patch({params:{email:a},data:{dragCaptchaToken:$('[name="dragCaptchaToken"]').val()}}).then(function(e){(0,f.default)("success","重置密码邮件已发送"),window.location.href=$("#password-reset-form").data("success")+"?email="+a}).catch(function(t){4040104==(t.responseJSON.error.code||0)&&e.drag.initDragCaptcha()})}}),$.validator.addMethod("passwordSms",function(t,a){var r=!1;return u.default.resetPasswordSms.validate({params:{mobile:$("#mobile").val(),smsCode:$("#sms-code").val()},data:{smsToken:e.smsToken},async:!1,promise:!1}).success(function(e){r="sms.code.success"==e}),r},$.validator.format(Translator.trans("validate.sms_code.message"))),this.mobileValidator=$("#password-reset-by-mobile-form").validate({rules:{mobile:{required:!0,phone:!0,es_remote:{type:"get",callback:function(e){e?$(".js-sms-send").removeClass("disabled"):$(".js-sms-send").addClass("disabled")}}},sms_code:{required:!0,unsigned_integer:!0,rangelength:[6,6],passwordSms:!0},dragCaptchaToken:{required:!0},reset_password:{required:!0,minlength:5,maxlength:20}},messages:{sms_code:{required:Translator.trans("auth.password_reset.sms_code_required_hint"),rangelength:Translator.trans("auth.password_reset.sms_code_validate_hint")},dragCaptchaToken:{required:Translator.trans("site.captcha_code.required")}},submitHandler:function(t){u.default.resetPasswordMobile.patch({params:{mobile:$("#mobile").val()},data:{smsToken:e.smsToken,smsCode:$("#sms-code").val(),encrypt_password:window.XXTEA.encryptToBase64($("#reset_password").val(),window.location.host),dragCaptchaToken:$('[name="dragCaptchaToken"]').val()}}).then(function(e){(0,f.default)("success","重置密码成功"),window.location.href=$("#password-reset-form").data("success")+"?mobile="+$("#mobile").val()})}})}}]),e}())},"9415ea13985847610e60":function(e,t,a){"use strict";!function(e){function t(e,t){var a=e.length,r=a<<2;if(t){var n=e[a-1];if(r-=4,n<r-3||n>r)return null;r=n}for(var s=0;s<a;s++)e[s]=String.fromCharCode(255&e[s],e[s]>>>8&255,e[s]>>>16&255,e[s]>>>24&255);var o=e.join("");return t?o.substring(0,r):o}function a(e,t){var a=e.length,r=a>>2;0!=(3&a)&&++r;var n;t?(n=new Array(r+1),n[r]=a):n=new Array(r);for(var s=0;s<a;++s)n[s>>2]|=e.charCodeAt(s)<<((3&s)<<3);return n}function r(e){return 4294967295&e}function n(e,t,a,r,n,s){return(a>>>5^t<<2)+(t>>>3^a<<4)^(e^t)+(s[3&r^n]^a)}function s(e){return e.length<4&&(e.length=4),e}function o(e,t){var a,s,o,i,c,d,u=e.length,l=u-1;for(s=e[l],o=0,d=0|Math.floor(6+52/u);d>0;--d){for(o=r(o+v),i=o>>>2&3,c=0;c<l;++c)a=e[c+1],s=e[c]=r(e[c]+n(o,a,s,c,i,t));a=e[0],s=e[l]=r(e[l]+n(o,a,s,l,i,t))}return e}function i(e,t){var a,s,o,i,c,d,u=e.length,l=u-1;for(a=e[0],d=Math.floor(6+52/u),o=r(d*v);0!==o;o=r(o-v)){for(i=o>>>2&3,c=l;c>0;--c)s=e[c-1],a=e[c]=r(e[c]-n(o,a,s,c,i,t));s=e[l],a=e[0]=r(e[0]-n(o,a,s,0,i,t))}return e}function c(e){if(/^[\x00-\x7f]*$/.test(e))return e;for(var t=[],a=e.length,r=0,n=0;r<a;++r,++n){var s=e.charCodeAt(r);if(s<128)t[n]=e.charAt(r);else if(s<2048)t[n]=String.fromCharCode(192|s>>6,128|63&s);else{if(!(s<55296||s>57343)){if(r+1<a){var o=e.charCodeAt(r+1);if(s<56320&&56320<=o&&o<=57343){var i=65536+((1023&s)<<10|1023&o);t[n]=String.fromCharCode(240|i>>18&63,128|i>>12&63,128|i>>6&63,128|63&i),++r;continue}}throw new Error("Malformed string")}t[n]=String.fromCharCode(224|s>>12,128|s>>6&63,128|63&s)}}return t.join("")}function d(e,t){for(var a=new Array(t),r=0,n=0,s=e.length;r<t&&n<s;r++){var o=e.charCodeAt(n++);switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a[r]=o;break;case 12:case 13:if(!(n<s))throw new Error("Unfinished UTF-8 octet sequence");a[r]=(31&o)<<6|63&e.charCodeAt(n++);break;case 14:if(!(n+1<s))throw new Error("Unfinished UTF-8 octet sequence");a[r]=(15&o)<<12|(63&e.charCodeAt(n++))<<6|63&e.charCodeAt(n++);break;case 15:if(!(n+2<s))throw new Error("Unfinished UTF-8 octet sequence");var i=((7&o)<<18|(63&e.charCodeAt(n++))<<12|(63&e.charCodeAt(n++))<<6|63&e.charCodeAt(n++))-65536;if(!(0<=i&&i<=1048575))throw new Error("Character outside valid Unicode range: 0x"+i.toString(16));a[r++]=i>>10&1023|55296,a[r]=1023&i|56320;break;default:throw new Error("Bad UTF-8 encoding 0x"+o.toString(16))}}return r<t&&(a.length=r),String.fromCharCode.apply(String,a)}function u(e,t){for(var a=[],r=new Array(32768),n=0,s=0,o=e.length;n<t&&s<o;n++){var i=e.charCodeAt(s++);switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r[n]=i;break;case 12:case 13:if(!(s<o))throw new Error("Unfinished UTF-8 octet sequence");r[n]=(31&i)<<6|63&e.charCodeAt(s++);break;case 14:if(!(s+1<o))throw new Error("Unfinished UTF-8 octet sequence");r[n]=(15&i)<<12|(63&e.charCodeAt(s++))<<6|63&e.charCodeAt(s++);break;case 15:if(!(s+2<o))throw new Error("Unfinished UTF-8 octet sequence");var c=((7&i)<<18|(63&e.charCodeAt(s++))<<12|(63&e.charCodeAt(s++))<<6|63&e.charCodeAt(s++))-65536;if(!(0<=c&&c<=1048575))throw new Error("Character outside valid Unicode range: 0x"+c.toString(16));r[n++]=c>>10&1023|55296,r[n]=1023&c|56320;break;default:throw new Error("Bad UTF-8 encoding 0x"+i.toString(16))}if(n>=32766){var d=n+1;r.length=d,a[a.length]=String.fromCharCode.apply(String,r),t-=d,n=-1}}return n>0&&(r.length=n,a[a.length]=String.fromCharCode.apply(String,r)),a.join("")}function l(e,t){return(void 0===t||null===t||t<0)&&(t=e.length),0===t?"":/^[\x00-\x7f]*$/.test(e)||!/^[\x00-\xff]*$/.test(e)?t===e.length?e:e.substr(0,t):t<65535?d(e,t):u(e,t)}function f(e,r){return void 0===e||null===e||0===e.length?e:(e=c(e),r=c(r),t(o(a(e,!0),s(a(r,!1))),!1))}function h(t,a){return e.btoa(f(t,a))}function g(e,r){return void 0===e||null===e||0===e.length?e:(r=c(r),l(t(i(a(e,!1),s(a(r,!1))),!0)))}function m(t,a){return void 0===t||null===t||0===t.length?t:g(e.atob(t),a)}void 0===e.btoa&&(e.btoa=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return function(t){var a,r,n,s,o,i,c;for(r=n=0,s=t.length,o=s%3,s-=o,i=s/3<<2,o>0&&(i+=4),a=new Array(i);r<s;)c=t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<8|t.charCodeAt(r++),a[n++]=e[c>>18]+e[c>>12&63]+e[c>>6&63]+e[63&c];return 1==o?(c=t.charCodeAt(r++),a[n++]=e[c>>2]+e[(3&c)<<4]+"=="):2==o&&(c=t.charCodeAt(r++)<<8|t.charCodeAt(r++),a[n++]=e[c>>10]+e[c>>4&63]+e[(15&c)<<2]+"="),a.join("")}}()),void 0===e.atob&&(e.atob=function(){var e=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];return function(t){var a,r,n,s,o,i,c,d,u,l;if((c=t.length)%4!=0)return"";if(/[^ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\+\/\=]/.test(t))return"";for(d="="==t.charAt(c-2)?1:"="==t.charAt(c-1)?2:0,u=c,d>0&&(u-=4),u=3*(u>>2)+d,l=new Array(u),o=i=0;o<c&&-1!=(a=e[t.charCodeAt(o++)])&&-1!=(r=e[t.charCodeAt(o++)])&&(l[i++]=String.fromCharCode(a<<2|(48&r)>>4),-1!=(n=e[t.charCodeAt(o++)]))&&(l[i++]=String.fromCharCode((15&r)<<4|(60&n)>>2),-1!=(s=e[t.charCodeAt(o++)]));)l[i++]=String.fromCharCode((3&n)<<6|s);return l.join("")}}());var v=2654435769;e.XXTEA={utf8Encode:c,utf8Decode:l,encrypt:f,encryptToBase64:h,decrypt:g,decryptFromBase64:m}}(window)},"971935e6d9dafc951b13":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.countDown=function e(t,a,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};if(t.addClass("disabled").attr("disabled",!0),a.data("count-down-text")||a.data("count-down-text",a.text()),a.text(r+" 秒后重新获取"),--r<0)return t.removeClass("disabled").attr("disabled",!1),a.text(a.data("count-down-text")),void n();setTimeout(function(){e(t,a,r,n)},1e3)}},bbc0ef257199acca9fed:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),d=a("5eb223de522186da1dd9"),u=r(d),l=a("9181c6995ae8c5c94b7a"),f=a("17c25dd7d9d2615bc1d9"),h=r(f),g=function(e){function t(e,a,r){s(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.$element=e,n.$target=a,n.params={top:0,left:0,currentX:0,currentY:0,flag:!1,currentLeft:0,currentTop:0},n.data=Object.assign({times:2},r),n.dragCaptchaToken=null,n.init(),n}return i(t,e),c(t,[{key:"init",value:function(){this.initDragCaptcha(),this.getLocation(this.$element[0])}},{key:"initDragCaptcha",value:function(){var e=this,t=this;u.default.dragCaptcha.get({before:function(){$(".js-drag-img-mask").removeClass("hidden"),$(".js-jigsaw-bg").remove(),$(".js-jigsaw").attr("src",""),t.setCss(t.$element[0],"cursor","pointer"),t.resetLocation(t.$element[0],t.$target[0]),$('[name="dragCaptchaToken"]').val(""),t.initEvent()},data:this.data}).then(function(t){e.loadingImg(t.url,t.jigsaw),e.dragCaptchaToken=t.token})}},{key:"loadingImg",value:function(e,t){var a=new Image;a.src=e,a.className="js-jigsaw-bg drag-img__bg",a.onload=function(){$(".js-jigsaw-bg").length>0||($(a).prependTo(".js-drag-img"),$(".js-drag-img-mask").addClass("hidden"),$(".js-jigsaw").attr("src",t))}}},{key:"initEvent",value:function(){var e=this;this.unbindEvent();var t=$(document);this.$element.on("mousedown.drag.captcha touchstart.drag.captcha",function(t){e.startDrag(t)}),t.on("mouseup.drag.captcha touchend.drag.captcha",function(t){e.stopDrag(t)}),t.on("mousemove.drag.captcha touchmove.drag.captcha",function(t){e.dragMove(t)})}},{key:"unbindEvent",value:function(){this.$element.unbind("mousedown.drag.captcha touchstart.drag.captcha"),$(document).unbind("mousemove.drag.captcha touchmove.drag.captcha mouseup.drag.captcha touchend.drag.captcha")}},{key:"startDrag",value:function(e){e.preventDefault();var t=this.params;t.flag=!0;var a=e.clientX?e.clientX.toFixed(2):e.originalEvent.targetTouches[0].pageX.toFixed(2);t.currentX=a}},{key:"stopDrag",value:function(e){var t=this,a=this.$element,r=(this.$target,this.params);if(r.flag&&(r.flag=!1,this.getLocation(a[0]),r.currentLeft)){var n=$(".js-jigsaw-bg"),s=this.calPositionX(n),o=this._getToken(this.dragCaptchaToken,s),i={token:o};u.default.dragCaptcha.validate({params:i}).then(function(e){t.validateSuccess(a[0],o)}).catch(function(){t.initDragCaptcha(),t.emit("error")})}}},{key:"dragMove",value:function(e){var t=this.$element,a=this.$target,r=this.params;if(r.flag){e.preventDefault();var n=e.clientX?e.clientX.toFixed(2):e.originalEvent.targetTouches[0].pageX.toFixed(2),s=n-r.currentX,o=t.parent().width()-t.width(),i=parseInt(r.left)+s;i<=0&&(i=0),i>=o&&(i=o),r.currentLeft=i;var c=i+"px";this.setCss(t[0],"left",c),this.setCss(a[0],"left",c),this.setCss(t[0],"cursor","move"),$(".js-drag-bar-tip").addClass("hidden");var d=i+20+"px";$(".js-drag-bar-mask").css("width",d)}}},{key:"calPositionX",value:function(e){var t=(e[0].naturalWidth/e.width()).toFixed(2);return(this.params.currentLeft.toFixed(2)*t).toFixed(2)}},{key:"validateSuccess",value:function(e,t){cd.message({type:"success",message:Translator.trans("validate.success")});var a=$('[name="dragCaptchaToken"]');a.val(t);var r=a.closest(".form-group");r.removeClass("has-error"),r.find(".jq-validate-error").remove(),this.unbindEvent(),this.setCss(e,"cursor","not-allowed"),this.emit("success",{token:t})}},{key:"getLocation",value:function(e){"auto"!==this.getCss(e,"left")&&(this.params.left=this.getCss(e,"left"))}},{key:"resetLocation",value:function(e,t){this.setCss(e,"left","0px"),this.setCss(t,"left","0px"),this.getLocation(e),$(".js-drag-bar-mask").css("width","0px"),$(".js-drag-bar-tip").removeClass("hidden")}},{key:"getCss",value:function(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,!1)[t]}},{key:"setCss",value:function(e,t,a){e.style[t]=a}},{key:"_getToken",value:function(e,t){var a={token:e,captcha:t};return e=JSON.stringify(a),[].concat(n((0,l.strToBase64)(e))).reverse().join("")}}]),t}(h.default);t.default=g}},["8fe9b6e117bbb964d58b"]);