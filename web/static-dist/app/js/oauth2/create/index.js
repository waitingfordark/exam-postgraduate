webpackJsonp(["app/js/oauth2/create/index"],{0:function(e,t){e.exports=jQuery},"04e12e97a64b943320e3":function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),i=a("e104a65d9efb9ac573bc"),o=a("b334fd7e4c5a19234db2"),c=(n(o),a("0fcd3a355c9fe74234e3")),u=a("5eb223de522186da1dd9"),d=n(u),l=a("bbc0ef257199acca9fed"),h=n(l),f=function(){function e(){r(this,e),this.$form=$("#third-party-create-account-form"),this.$btn=$(".js-submit-btn"),this.validator=null,this.dragCaptchaToken="",this.smsToken=null,this.$sendBtn=$(".js-sms-send"),this.drag=!!$("#drag-btn").length&&new h.default($("#drag-btn"),$(".js-jigsaw"),{limitType:"bind_register"}),this.init()}return s(e,[{key:"init",value:function(){this.initValidator(),this.smsSend(),this.submitForm(),this.removeSmsErrorTip(),this.dragEvent()}},{key:"dragEvent",value:function(){var e=this;this.drag&&this.drag.on("success",function(t){e.$sendBtn.attr("disabled",!1),e.dragCaptchaToken=t.token}),$(".js-drag-jigsaw").hasClass("hidden")||this.addDragCaptchaRules()}},{key:"initValidator",value:function(){this.rules={username:{required:!0,byte_minlength:4,byte_maxlength:18,nickname:!0,chinese_alphanumeric:!0,es_remote:{type:"get"}},invitedCode:{required:!1,reg_inviteCode:!0,es_remote:{type:"get"}},password:{required:!0,minlength:5,maxlength:20},confirmPassword:{required:!0,equalTo:"#password"},sms_code:{required:!0,unsigned_integer:!0,rangelength:[6,6]}},this.validator=this.$form.validate({rules:this.rules,messages:{sms_code:{required:Translator.trans("site.captcha_code.required"),rangelength:Translator.trans("validate.sms_code.message")}}})}},{key:"smsSend",value:function(){var e=this,t=this,a=$("#captcha_code");this.$sendBtn.length&&this.$sendBtn.click(function(n){t.smsSended||($.ajaxSetup({global:!1}),t.smsSended=!0),t.$sendBtn.attr("disabled",!0);var r={type:"register",mobile:$(".js-account").text(),dragCaptchaToken:e.dragCaptchaToken,phrase:a.val()};d.default.sms.send({data:r}).then(function(t){$.ajaxSetup({global:!0}),e.smsToken=t.smsToken,(0,c.countDown)(120)}).catch(function(e){t.drag&&($.ajaxSetup({global:!0}),t.addDragCaptchaRules(),t.drag.initDragCaptcha(),$(".js-drag-jigsaw").removeClass("hidden"))})})}},{key:"submitForm",value:function(){var e=this;this.$btn.click(function(t){var a=$(t.target);if(e.validator.form()){a.button("loading");var n={nickname:$("#username").val(),password:$("#password").val(),mobile:$(".js-account").html(),smsToken:e.smsToken,smsCode:$("#sms-code").val(),captchaToken:e.captchaToken,phrase:$("#captcha_code").val(),dragCaptchaToken:$('[name="dragCaptchaToken"]').val(),invitedCode:$("#invitedCode").length>0?$("#invitedCode").val():""},r=Translator.trans("oauth.send.sms_code_error_tip");$.post(a.data("url"),n,function(e){a.button("reset"),1===e.success?window.location.href=e.url:$(".js-password-error").length||a.prev().addClass("has-error").append('<p id="password-error" class="form-error-message js-password-error">'+r+"</p>")}).error(function(e){a.button("reset")})}}),(0,i.enterSubmit)(this.$form,this.$btn)}},{key:"addDragCaptchaRules",value:function(){$('[name="dragCaptchaToken"]').rules("add",{required:!0,messages:{required:Translator.trans("auth.register.drag_captcha_tips")}})}},{key:"removeSmsErrorTip",value:function(){$("#sms-code").focus(function(){var e=$(".js-password-error");e.length&&e.remove()})}}]),e}();t.default=f},"0fcd3a355c9fe74234e3":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.countDown=void 0;var n=a("b334fd7e4c5a19234db2"),r=function(e){return e&&e.__esModule?e:{default:e}}(n),s=$(".js-time-left"),i=$(".js-sms-send"),o=$(".js-fetch-btn-text"),c=(t.countDown=function(e){s.html(e),o.html(Translator.trans("site.data.get_sms_code_again_btn")),(0,r.default)("success",Translator.trans("site.data.get_sms_code_success_hint")),c()},function e(){var t=s.text();s.html(t-1),t-1>0?(i.attr("disabled",!0),setTimeout(e,1e3)):(s.html(""),o.html(Translator.trans("oauth.send.validate_message")),i.removeAttr("disabled"))})},"1d43a4025aadc22df310":function(e,t,a){"use strict";var n=a("04e12e97a64b943320e3");new(function(e){return e&&e.__esModule?e:{default:e}}(n).default)},bbc0ef257199acca9fed:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),u=a("5eb223de522186da1dd9"),d=n(u),l=a("9181c6995ae8c5c94b7a"),h=a("17c25dd7d9d2615bc1d9"),f=n(h),g=function(e){function t(e,a,n){s(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.$element=e,r.$target=a,r.params={top:0,left:0,currentX:0,currentY:0,flag:!1,currentLeft:0,currentTop:0},r.data=Object.assign({times:2},n),r.dragCaptchaToken=null,r.init(),r}return o(t,e),c(t,[{key:"init",value:function(){this.initDragCaptcha(),this.getLocation(this.$element[0])}},{key:"initDragCaptcha",value:function(){var e=this,t=this;d.default.dragCaptcha.get({before:function(){$(".js-drag-img-mask").removeClass("hidden"),$(".js-jigsaw-bg").remove(),$(".js-jigsaw").attr("src",""),t.setCss(t.$element[0],"cursor","pointer"),t.resetLocation(t.$element[0],t.$target[0]),$('[name="dragCaptchaToken"]').val(""),t.initEvent()},data:this.data}).then(function(t){e.loadingImg(t.url,t.jigsaw),e.dragCaptchaToken=t.token})}},{key:"loadingImg",value:function(e,t){var a=new Image;a.src=e,a.className="js-jigsaw-bg drag-img__bg",a.onload=function(){$(".js-jigsaw-bg").length>0||($(a).prependTo(".js-drag-img"),$(".js-drag-img-mask").addClass("hidden"),$(".js-jigsaw").attr("src",t))}}},{key:"initEvent",value:function(){var e=this;this.unbindEvent();var t=$(document);this.$element.on("mousedown.drag.captcha touchstart.drag.captcha",function(t){e.startDrag(t)}),t.on("mouseup.drag.captcha touchend.drag.captcha",function(t){e.stopDrag(t)}),t.on("mousemove.drag.captcha touchmove.drag.captcha",function(t){e.dragMove(t)})}},{key:"unbindEvent",value:function(){this.$element.unbind("mousedown.drag.captcha touchstart.drag.captcha"),$(document).unbind("mousemove.drag.captcha touchmove.drag.captcha mouseup.drag.captcha touchend.drag.captcha")}},{key:"startDrag",value:function(e){e.preventDefault();var t=this.params;t.flag=!0;var a=e.clientX?e.clientX.toFixed(2):e.originalEvent.targetTouches[0].pageX.toFixed(2);t.currentX=a}},{key:"stopDrag",value:function(e){var t=this,a=this.$element,n=(this.$target,this.params);if(n.flag&&(n.flag=!1,this.getLocation(a[0]),n.currentLeft)){var r=$(".js-jigsaw-bg"),s=this.calPositionX(r),i=this._getToken(this.dragCaptchaToken,s),o={token:i};d.default.dragCaptcha.validate({params:o}).then(function(e){t.validateSuccess(a[0],i)}).catch(function(){t.initDragCaptcha(),t.emit("error")})}}},{key:"dragMove",value:function(e){var t=this.$element,a=this.$target,n=this.params;if(n.flag){e.preventDefault();var r=e.clientX?e.clientX.toFixed(2):e.originalEvent.targetTouches[0].pageX.toFixed(2),s=r-n.currentX,i=t.parent().width()-t.width(),o=parseInt(n.left)+s;o<=0&&(o=0),o>=i&&(o=i),n.currentLeft=o;var c=o+"px";this.setCss(t[0],"left",c),this.setCss(a[0],"left",c),this.setCss(t[0],"cursor","move"),$(".js-drag-bar-tip").addClass("hidden");var u=o+20+"px";$(".js-drag-bar-mask").css("width",u)}}},{key:"calPositionX",value:function(e){var t=(e[0].naturalWidth/e.width()).toFixed(2);return(this.params.currentLeft.toFixed(2)*t).toFixed(2)}},{key:"validateSuccess",value:function(e,t){cd.message({type:"success",message:Translator.trans("validate.success")});var a=$('[name="dragCaptchaToken"]');a.val(t);var n=a.closest(".form-group");n.removeClass("has-error"),n.find(".jq-validate-error").remove(),this.unbindEvent(),this.setCss(e,"cursor","not-allowed"),this.emit("success",{token:t})}},{key:"getLocation",value:function(e){"auto"!==this.getCss(e,"left")&&(this.params.left=this.getCss(e,"left"))}},{key:"resetLocation",value:function(e,t){this.setCss(e,"left","0px"),this.setCss(t,"left","0px"),this.getLocation(e),$(".js-drag-bar-mask").css("width","0px"),$(".js-drag-bar-tip").removeClass("hidden")}},{key:"getCss",value:function(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,!1)[t]}},{key:"setCss",value:function(e,t,a){e.style[t]=a}},{key:"_getToken",value:function(e,t){var a={token:e,captcha:t};return e=JSON.stringify(a),[].concat(r((0,l.strToBase64)(e))).reverse().join("")}}]),t}(f.default);t.default=g},e104a65d9efb9ac573bc:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){e.keypress(function(e){13==e.which&&(t.trigger("click"),e.preventDefault())})};t.enterSubmit=n}},["1d43a4025aadc22df310"]);