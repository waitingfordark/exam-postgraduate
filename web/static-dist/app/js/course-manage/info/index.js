webpackJsonp(["app/js/course-manage/info/index"],{"2e99c3409e5b9bc7ee65":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.debounce=function(e,t,n){var a=void 0,r=0;return function(){for(var i=arguments.length,s=Array(i),o=0;o<i;o++)s[o]=arguments[o];if(n)a&&clearTimeout(a),a=setTimeout(function(){e.apply(void 0,s)},t);else{var l=(new Date).getTime();if(l-r<t)return;r=l,e.apply(void 0,s)}}}},"4a2a736e6778c19b97fd":function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();n("d5e8fa5f17ac5fe79c78");var i=n("fe53252afd7b6c35cb73"),s=(function(e){e&&e.__esModule}(i),n("2e99c3409e5b9bc7ee65")),o=function(){function e(){a(this,e),this.intro=null,this.customClass="es-intro-help multistep",this.$intro=$(".js-plan-intro"),this.init()}return r(e,[{key:"init",value:function(){this.$intro.length&&(store.get("COURSE_BASE_INTRO")||(store.set("COURSE_BASE_INTRO",!0),this.introStart(this.initAllSteps()),this.$intro.addClass("hidden")),this.initEvent())}},{key:"initEvent",value:function(){var e=this,t=this;$("body").on("click",".js-skip",function(t){e.intro.exit(),e.$intro.removeClass("hidden")}),$("body").on("click",".js-plan-intro-btn",function(t){$("html").scrollTop(0),e.introStart(e.initSingleStep())}),window.addEventListener("scroll",(0,s.debounce)(t.scrollPosition,100,!0))}},{key:"introStart",value:function(e){var t=this,n='<i class="es-icon es-icon-close01"></i>';this.intro=introJs(),this.customClass=e.length<2?"es-intro-help js-intro-help es-intro-single":"es-intro-help js-intro-help multistep",this.intro.setOptions({steps:e,skipLabel:n,nextLabel:Translator.trans("course_set.manage.next_label"),prevLabel:Translator.trans("course_set.manage.prev_label"),doneLabel:n,showBullets:!1,tooltipPosition:"auto",showStepNumbers:!1,exitOnEsc:!1,exitOnOverlayClick:!1,tooltipClass:this.customClass});var a=this;this.intro.start().onexit(function(){a.$intro.removeClass("hidden")}).onchange(function(){0!==t.intro._currentStep?t.intro.setOptions({tooltipClass:"es-intro-help multistep es-intro-normal-tip"}):t.intro.setOptions({tooltipClass:"es-intro-help multistep"}),t.intro._currentStep==t.intro._introItems.length-1?$(".introjs-nextbutton").before('<a class="introjs-button done-button js-skip">'+Translator.trans("intro.confirm_hint")+"<a/>"):$(".js-skip").remove()}),$(".js-intro-help").parent().css("top","0")}},{key:"scrollPosition",value:function(){var e=$(".js-plan-intro");$(document).scrollTop()>440?e.addClass("course-manage-intro-float"):e.removeClass("course-manage-intro-float")}},{key:"initAllSteps",value:function(){return[{intro:Translator.trans("course_set.manage.img")},{element:"#step-1",intro:Translator.trans("course_set.manage.couseset_tab")},{element:"#step-2",intro:Translator.trans("course_set.manage.single_plan")},{element:"#step-3",intro:Translator.trans("course_set.manage.all_plan")},{element:"#step-4",intro:Translator.trans("course_set.manage.publish_courseset")}]}},{key:"initSingleStep",value:function(){return[{intro:Translator.trans("course_set.manage.img")}]}}]),e}();t.default=o},"64f69b56d0a1d80f135d":function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=function(){function e(){a(this,e),this.init()}return r(e,[{key:"init",value:function(){this.checkBoxChange()}},{key:"checkBoxChange",value:function(){var e=this;$('input[name="deadlineType"]').on("change",function(t){var n=$("#deadlineType-date"),a=$("#deadlineType-days"),r=$('input[name="deadlineType"]:checked').val();e.removeErrorTip(t),"end_date"===r?(n.removeClass("hidden"),a.addClass("hidden")):(n.addClass("hidden"),a.removeClass("hidden")),e.commonExpiryMode(!0)}),$('input[name="expiryMode"]').on("change",function(t){var n=$("#expiry-days"),a=$("#expiry-date"),r=$('input[name="expiryMode"]:checked').val();e.removeErrorTip(t);var i=$(".js-expiry-tip");"date"===r?(n.addClass("hidden"),a.removeClass("hidden"),i.removeClass("ml0")):"days"===r?(a.addClass("hidden"),n.removeClass("hidden"),i.removeClass("ml0")):(a.addClass("hidden"),n.addClass("hidden"),i.addClass("ml0")),e.commonExpiryMode(!0)})}},{key:"commonExpiryMode",value:function(e){var t=this,n=$('[name="deadline"]'),a=$('[name="expiryDays"]'),r=$('[name="expiryStartDate"]'),i=$('[name="expiryEndDate"]'),s=$('[name="deadlineType"]:checked'),o=$('[name="expiryMode"]:checked').val();switch(this.elementRemoveRules(n),this.elementRemoveRules(a),this.elementRemoveRules(r),this.elementRemoveRules(i),o){case"days":if("end_date"===s.val())return void(e?n.on("focus",function(){t.elementAddRules(n,t.getDeadlineEndDateRules())}):this.elementAddRules(n,this.getDeadlineEndDateRules()));e?a.on("focus",function(){t.elementAddRules(a,t.getExpiryDaysRules())}):this.elementAddRules(a,this.getExpiryDaysRules());break;case"date":e?(r.on("focus",function(){t.elementAddRules(r,t.getExpiryStartDateRules())}),i.on("focus",function(){t.elementAddRules(i,t.getExpiryEndDateRules())})):(this.elementAddRules(r,this.getExpiryStartDateRules()),this.elementAddRules(i,this.getExpiryEndDateRules()))}}},{key:"removeErrorTip",value:function(e){var t=$(e.target).closest(".form-group");t.removeClass("has-error"),t.find(".js-expiry-input").removeClass("form-control-error"),$(".jq-validate-error").remove()}},{key:"elementRemoveRules",value:function(e){e.rules("remove")}},{key:"elementAddRules",value:function(e,t){e.rules("add",t)}},{key:"getExpiryDaysRules",value:function(){return{required:!0,positive_integer:!0,max_year:!0,messages:{required:Translator.trans(Translator.trans("course.manage.expiry_days_error_hint"))}}}},{key:"getExpiryStartDateRules",value:function(){return{required:!0,date:!0,before_date:"#expiryEndDate",messages:{required:Translator.trans("course.manage.expiry_start_date_error_hint")}}}},{key:"getExpiryEndDateRules",value:function(){return{required:!0,date:!0,after_date:"#expiryStartDate",messages:{required:Translator.trans("course.manage.expiry_end_date_error_hint")}}}},{key:"getDeadlineEndDateRules",value:function(){return{required:!0,date:!0,messages:{required:Translator.trans("course.manage.deadline_end_date_error_hint")}}}}]),e}();t.default=i},a1c4a43f5d1c99d74a21:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=n("4a2a736e6778c19b97fd"),o=a(s),l=n("64f69b56d0a1d80f135d"),u=a(l),d=n("e8dcf55cc635b1b908d6");new(function(){function e(){r(this,e),$("#maxStudentNum-field").length>0&&$.get($("#maxStudentNum-field").data("liveCapacityUrl")).done(function(e){$("#maxStudentNum-field").data("liveCapacity",e.capacity)}),this.initValidator(),this.checkBoxChange(),this.changeAudioMode(),this.initDatetimepicker(),this.setService(),this.taskPriceSetting(),this.setIntroPosition(),this.initCkeditor(),this.expiry=new u.default}return i(e,[{key:"setIntroPosition",value:function(){var e=$(".js-course-manage-info").offset().left+44;window.onload=function(){$(".js-plan-intro").css("right",e+"px").removeClass("hidden")}}},{key:"setService",value:function(){$(".js-service-item").click(function(e){var t=$(e.currentTarget),n=$("#course_services").val(),a=void 0;a=n?JSON.parse(n):[],t.hasClass("service-primary-item")?(t.removeClass("service-primary-item"),a.splice(a.indexOf(t.data("code")),1)):(t.addClass("service-primary-item"),a.push(t.data("code"))),$("#course_services").val(JSON.stringify(a))})}},{key:"initDatetimepicker",value:function(){var e=this;$('input[name="buyExpiryTime"]').datetimepicker({format:"yyyy-mm-dd",language:document.documentElement.lang,minView:2,autoclose:!0}).on("hide",function(){e.validator&&e.validator.form()}),$('input[name="buyExpiryTime"]').datetimepicker("setStartDate",new Date(Date.now())),$('input[name="buyExpiryTime"]').datetimepicker("setEndDate",new Date(Date.now()+31536e7)),this.initDatePicker("#expiryStartDate"),this.initDatePicker("#expiryEndDate"),this.initDatePicker("#deadline")}},{key:"changeAudioMode",value:function(){$("#audio-modal-id").on("change","input[name='enableAudio']",function(){"notAllowed"==$("#course-audio-mode").data("value")&&(cd.message({type:"info",message:Translator.trans("course.audio.enable.biz.user")}),$("[name='enableAudio']")[1].checked=!0,$("[name='enableAudio']")[0].checked=!1)})}},{key:"initValidator",value:function(){var e=$("#course-info-form");$(".js-task-price-setting").perfectScrollbar(),this.validator=e.validate({currentDom:"#course-submit",ajax:!0,groups:{date:"expiryStartDate expiryEndDate"},rules:{maxStudentNum:{required:!0,live_capacity:!0,positive_integer:!0},expiryDays:{required:function(){return"date"!=$('input[name="expiryMode"]:checked').val()},digits:!0,max_year:!0},originPrice:{required:!0,positive_price:!0,min:0},expiryStartDate:{required:function(){return"date"==$('input[name="expiryMode"]:checked').val()},date:!0,before_date:"#expiryEndDate"},expiryEndDate:{required:function(){return"date"==$('input[name="expiryMode"]:checked').val()},date:!0,after_date:"#expiryStartDate"},summary:{ckeditor_maxlength:1e4}},messages:{originPrice:Translator.trans("validate_old.positive_currency.message"),maxStudentNum:{required:Translator.trans("course.manage.max_student_num_error_hint")},expiryDays:{required:Translator.trans("course.manage.deadline_end_date_error_hint")},expiryStartDate:{required:Translator.trans("course.manage.expiry_start_date_error_hint"),before:Translator.trans("course.manage.expiry_days_error_hint")},expiryEndDate:{required:Translator.trans("course.manage.expiry_end_date_error_hint"),after:Translator.trans("course.manage.expiry_start_date_error_hint")}},submitSuccess:function(e){cd.message({type:"success",message:Translator.trans("site.save_success_hint")}),window.location.reload()}}),$(".js-course-title").length&&($(".js-course-title").rules("add",{required:!0,maxlength:10,trim:!0,course_title:!0}),$(".js-course-subtitle").rules("add",{maxlength:30})),$(".js-courseset-title").length&&($(".js-courseset-title").rules("add",{required:!0,maxlength:60,trim:!0,course_title:!0}),$(".js-courseset-subtitle").rules("add",{maxlength:50})),$.validator.addMethod("before",function(e,t,n){return"date"!==$('input[name="expiryMode"]:checked').val()||(!e||$(n).val()>e)},Translator.trans("course.manage.expiry_end_date_error_hint")),$.validator.addMethod("after",function(e,t,n){return"date"!==$('input[name="expiryMode"]:checked').val()||(!e||$(n).val()<e)},Translator.trans("course.manage.expiry_start_date_error_hint")),$.validator.addMethod("max_year",function(e,t){return this.optional(t)||e<1e5},Translator.trans("course.manage.max_year_error_hint")),$.validator.addMethod("live_capacity",function(e,t){var n=parseInt($(t).data("liveCapacity"));if(e>n){var a=Translator.trans("course.manage.max_capacity_hint",{capacity:n});$(t).parent().siblings(".js-course-rule").find("p").html(a)}else $(t).parent().siblings(".js-course-rule").find("p").html("");return!0}),$("#tags").length&&(0,d.initTags)(),this.saveForm()}},{key:"initCkeditor",value:function(){var e=$("#courseset-summary-field");if(e.length){var t=this;t.editor=CKEDITOR.replace("summary",{allowedContent:!0,toolbar:"Detail",fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:this.uploadUrl}),t.editor.on("blur",function(){e.val(t.editor.getData())})}}},{key:"saveForm",value:function(){var e=this;$("#course-submit").on("click",function(t){e.expiry.commonExpiryMode();var n=$("#courseset-summary-field");n.length&&n.val(e.editor.getData()),e.validator.form()&&$("#course-info-form").submit()})}},{key:"initDatePicker",value:function(e){var t=this,n=$(e);n.datetimepicker({format:"yyyy-mm-dd",language:document.documentElement.lang,minView:2,autoclose:!0,endDate:new Date(Date.now()+31536e7)}).on("hide",function(){t.validator&&t.validator.element(n)}),n.datetimepicker("setStartDate",new Date)}},{key:"taskPriceSetting",value:function(){var e=$(".js-task-price-setting");e.on("click","li",function(e){var t=$(e.currentTarget);t.toggleClass("open");var n=t.find("input");n.prop("checked",!n.is(":checked"))}),e.on("click","input",function(e){e.stopPropagation(),$(e.target).closest("li").toggleClass("open")})}},{key:"checkBoxChange",value:function(){var e=this;$('input[name="buyable"]').on("change",function(t){0==$('input[name="buyable"]:checked').val()?($(".js-course-add-close-show").removeClass("hidden"),$(".js-course-add-open-show").addClass("hidden")):($(".js-course-add-close-show").addClass("hidden"),$(".js-course-add-open-show").removeClass("hidden")),e.initenableBuyExpiry()}),$('input[name="enableBuyExpiryTime"]').on("change",function(t){var n=$("#buyExpiryTime");0==$('input[name="enableBuyExpiryTime"]:checked').val()?n.addClass("hidden"):n.removeClass("hidden"),e.initenableBuyExpiry()}),$('input[name="expiryDays"]').on("blur",function(t){e.validator.element($(t.target))})}},{key:"elementRemoveRules",value:function(e){e.rules("remove")}},{key:"elementAddRules",value:function(e,t){e.rules("add",t)}},{key:"initenableBuyExpiry",value:function(){var e=$('[name="enableBuyExpiryTime"]:checked'),t=$('[name="buyable"]:checked'),n=$('[name="buyExpiryTime"]');1==t.val()&&1==e.val()?this.elementAddRules(n,this.getBuyExpiryTimeRules()):(this.elementRemoveRules(n),e.closest(".form-group").removeClass("has-error"),n.removeClass("form-control-error"),$(".jq-validate-error").remove())}},{key:"getBuyExpiryTimeRules",value:function(){return{required:!0,messages:{required:Translator.trans("course.manage.buy_expiry_time_required_error_hint")}}}}]),e}()),setTimeout(function(){new o.default},500)},e8dcf55cc635b1b908d6:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.initTags=function(){var e=$("#tags");e.select2({ajax:{url:e.data("url"),dataType:"json",quietMillis:500,data:function(e,t){return{q:e,page_limit:10}},results:function(e){return{results:e.map(function(e){return{id:e.name,name:e.name}})}}},initSelection:function(e,t){var n=[];$(e.val().split(",")).each(function(){n.push({id:this,name:this})}),t(n)},formatSelection:function(e){return e.name},formatResult:function(e){return e.name},formatNoMatches:function(){return Translator.trans("validate.tag_required_not_found_hint")},formatSearching:function(){return Translator.trans("site.searching_hint")},multiple:!0,maximumSelectionSize:20,placeholder:Translator.trans("course_set.manage.tag_required_hint"),width:"off",createSearchChoice:function(){return null}})}}},["a1c4a43f5d1c99d74a21"]);