webpackJsonp(["app/js/course-manage/batch-create/index"],{0:function(e,t){e.exports=jQuery},"51f055c8e85ba7c8e9b4":function(e,t,n){"use strict";var a=n("5899c7c7c1283bfb76ec");new(function(e){return e&&e.__esModule?e:{default:e}}(a).default)({element:"#uploader-container"})},"5899c7c7c1283bfb76ec":function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=n("b334fd7e4c5a19234db2"),i=function(e){return e&&e.__esModule?e:{default:e}}(o),l=function(){function e(t){a(this,e),this.element=$(t.element),this.uploader=null,this.files=[],this.$sortable=$("#sortable-list"),this.init()}return r(e,[{key:"init",value:function(){this.initUploader(),this.initEvent()}},{key:"initUploader",value:function(){var e=this,t=this.element;this.uploader=new UploaderSDK({id:t.attr("id"),initUrl:t.data("initUrl"),finishUrl:t.data("finishUrl"),accept:t.data("accept"),process:this.getUploadProcess(),ui:"batch",fileNumLimit:void 0!==t.data("numLimit")?t.data("numLimit"):null,locale:document.documentElement.lang}),this.uploader.on("file.finish",function(t){e.files.push(t)}),this.uploader.on("error",function(e){var t={F_DUPLICATE:Translator.trans("uploader.file.exist")};e.message||(e.message=t[e.error]),(0,i.default)("danger",e.message)})}},{key:"initEvent",value:function(){var e=this;$(".js-upload-params").on("change",function(t){e.uploader.setProcess(e.getUploadProcess())}),$(".js-batch-create-lesson-btn").on("click",function(t){if(!e.files.length)return void(0,i.default)("danger",Translator.trans("uploader.select_one_file"));var n=$(t.currentTarget);n.button("loading"),e.validLessonNum(n)&&e.files.map(function(t,a){var r=!1;a+1==e.files.length&&(r=!0),e.createLesson(n,t,r)})}),$('[data-toggle="popover"]').popover({html:!0})}},{key:"getUploadProcess",value:function(){var e=$(".js-upload-params").get().reduce(function(e,t){return e[$(t).attr("name")]=$(t).find("option:selected").val(),e},{}),t={video:e,document:{type:"html"}};return $("[name=support_mobile]").length>0&&(t.common={supportMobile:$("[name=support_mobile]").val()}),t}},{key:"validLessonNum",value:function(e){var t=!0;return $.ajax({type:"post",url:e.data("validUrl"),async:!1,data:{number:this.files.length},success:function(n){n&&n.error&&((0,i.default)("danger",n.error),e.button("reset"),t=!1),t=!0}}),t}},{key:"createLesson",value:function(e,t,n){var a=this;$.ajax({type:"post",url:e.data("url"),async:!1,data:{fileId:t.id},success:function(e){e&&e.error?(0,i.default)("danger",e.error):a.$sortable.trigger("addItem",e)},error:function(e){(0,i.default)("danger",Translator.trans("uploader.status.error"))},complete:function(e){n&&$("#modal").modal("hide")}})}}]),e}();t.default=l}},["51f055c8e85ba7c8e9b4"]);