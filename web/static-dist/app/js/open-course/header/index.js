webpackJsonp(["app/js/open-course/header/index"],{"73a109fead0f08f835ed":function(e,r,n){"use strict";var i=n("ef77ea6623b706a87a55"),o=function(e){return e&&e.__esModule?e:{default:e}}(i);if($("#firstLesson").length>0){new o.default({url:$("#firstLesson").data("url"),element:".open-course-views"})}},"87fce900c1efe27f8ef1":function(e,r,n){"use strict";function i(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(r,n,i){return n&&e(r.prototype,n),i&&e(r,i),r}}(),t=function(){function e(r){var n=r.element,o=r.courseUrl;i(this,e),this.$element=$(n),this.courseUrl=o,this.init()}return o(e,[{key:"init",value:function(){var e=this,r="";$.get(this.courseUrl).then(function(n){n.map(function(n){r+=e.template(n.id,n.cover,n.title)}),e.$element.find(".modal-body").html(r)})}},{key:"isWxAndroidBrowser",value:function(){var e=navigator.userAgent.toLowerCase();return/android/.test(e)&&/micromessenger/i.test(e)}},{key:"isWxPreviewType",value:function(){return this.$element.parent(".js-open-course-wechat-preview").length>0}},{key:"template",value:function(e,r,n){return'<div class="modal-img">\n        <a href="/course_set/'+e+'">\n          <img class="img-responsive" src="'+r.middle+'" alt="">\n        </a>\n        <div class="title"><a class="link-dark" href="/course_set/'+e+'">'+n+"</a></div>\n      </div>"}},{key:"show",value:function(){this.isWxPreviewType()||(this.isWxAndroidBrowser()&&(document.getElementById("viewerIframe").contentWindow.document.getElementById("lesson-player").style.display="none",this.$element.on("hide.bs.modal",function(){document.getElementById("viewerIframe").contentWindow.document.getElementById("lesson-player").style.display="block"})),this.$element.modal({backdrop:!1}))}},{key:"hide",value:function(){this.$element.modal("hide")}}]),e}();r.default=t},ef77ea6623b706a87a55:function(e,r,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function o(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var t=function(){function e(e,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(r,n,i){return n&&e(r.prototype,n),i&&e(r,i),r}}(),a=n("06597b47670159844043"),l=i(a),s=n("c04c1b91e3806f24595a"),d=i(s),u=n("87fce900c1efe27f8ef1"),c=i(u),f=function(){function e(r){var n=r.url,i=r.element;o(this,e),this.url=n,this.$element=$(i),this.player=null,this.lesson=null,this.courseAd=null,this.init(),this.initEvent()}return t(e,[{key:"init",value:function(){this.showPlayer()}},{key:"initEvent",value:function(){var e=this;this.$element.on("click",".js-player-replay",function(r){return e.replay(r)}),this.$element.on("click",".js-live-video-replay-btn",function(r){return e.onLiveVideoPlay(r)})}},{key:"showPlayer",value:function(){var e=this;$.get(this.url,function(r){if(r.mediaError)return $("#media-error-dialog").show(),void $("#media-error-dialog").find(".modal-body .media-error").html(r.mediaError);$("#media-error-dialog").hide(),e.lesson=r,$(".js-live-video-replay-btn").removeClass("hidden");var n={iframe:e.onIframe,self:e.onVideo},i=n[r.mediaSource]?n[r.mediaSource].bind(e):void 0;void 0!==i||"video"!=r.type&&"audio"!=r.type||(i=e.onSWF.bind(e)),void 0!==i&&i(e)})}},{key:"onIframe",value:function(){var e=$("#lesson-preview-iframe");e.empty();var r='<iframe class="embed-responsive-item" src="'+this.lesson.mediaUri+'" style="position:absolute; left:0; top:0; height:100%; width:100%; border:0px;" scrolling="no"></iframe>';e.html(r),e.show()}},{key:"onVideo",value:function(){var e=this.lesson;if("video"==e.type||"audio"==e.type){if("success"!=e.convertStatus&&"cloud"==e.storage)return $("#media-error-dialog").show(),void $("#media-error-dialog").find(".modal-body .media-error").html(Translator.trans("open_course.converting_hint"));var r="/open/course/"+e.courseId+"/lesson/"+e.id+"/player";this.videoPlay(r)}}},{key:"onSWF",value:function(){var e=this.lesson,r=$("#lesson-preview-swf-player");d.default.removeSWF("lesson-preview-swf-player"),r.html('<div id="lesson-swf-player"></div>'),d.default.embedSWF(e.mediaUri,"lesson-swf-player","100%","100%","9.0.0",null,null,{wmode:"opaque",allowFullScreen:"true"}),r.show()}},{key:"replay",value:function(){this.player?(this.player.replay(),this.courseAd.hide()):window.location.reload()}},{key:"onLiveVideoPlay",value:function(e){this.$element.find(".js-live-header-mask").hide();var r=$(e.currentTarget),n=this.lesson;if(n.mediaError)return $("#media-error-dialog").show(),void $("#media-error-dialog").find(".modal-body .media-error").html(n.mediaError);if($("#media-error-dialog").hide(),"liveOpen"==n.type&&"videoGenerated"==n.replayStatus){if("success"!=n.convertStatus&&"cloud"==n.storage)return $("#media-error-dialog").show(),void $("#media-error-dialog").find(".modal-body .media-error").html(Translator.trans("open_course.converting_hint"));var i=r.data("referer"),o="/open/course/"+n.courseId+"/lesson/"+n.id+"/player?referer="+i;this.videoPlay(o)}}},{key:"getPlayer",value:function(){return window.frames.viewerIframe.window.BalloonPlayer||window.frames.viewerIframe.window.player}},{key:"videoPlay",value:function(e){var r=this,n=$("#lesson-preview-player");n.html("");var i='<iframe \n      class="embed-responsive-item" \n      src="'+e+'" \n      name="viewerIframe" \n      id="viewerIframe" \n      width="100%" \n      allowfullscreen \n      webkitallowfullscreen \n      height="100%"" \n      style="border:0px;position:absolute; left:0; top:0;"></iframe>';n.html(i).show();var o=new l.default({name:"parent",project:"PlayerProject",children:[document.getElementById("viewerIframe")],type:"parent"});o.on("ready",function(){var e=r.getPlayer();r.player=e}),o.on("ended",function(){r.onPlayEnd()})}},{key:"onPlayEnd",value:function(){this.showADModal()}},{key:"showADModal",value:function(){if(this.courseAd)return void this.courseAd.show();this.courseAd=new c.default({element:"#open-course-ad-modal",courseUrl:this.$element.data("get-recommend-course-url")}),this.courseAd.show()}}]),e}();r.default=f}},["73a109fead0f08f835ed"]);